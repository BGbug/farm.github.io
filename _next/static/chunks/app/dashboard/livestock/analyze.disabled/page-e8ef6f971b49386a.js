(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5709],{254:e=>{"use strict";e.exports=require("genkit")},9255:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},13612:(e,a,t)=>{Promise.resolve().then(t.bind(t,26554))},26554:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>E});var s=t(95155),i=t(12115),n=t(63154),r=t(254);let l=r.z.object({imageDataUri:r.z.string().describe("A snapshot from a camera feed of livestock, as a data URI that must include a MIME type and use Base64 encoding. Expected format: 'data:<mimetype>;base64,<encoded_data>'."),animalType:r.z.enum(["Cow","Goat","Chicken","Buffalo","Sheep","Other"]).describe("The general type of animal in the image.")}),c=r.z.object({observation:r.z.string().describe('A specific observation about an animal or the group (e.g., "One cow is limping on its front-left leg", "Several chickens appear lethargic").'),recommendation:r.z.string().describe('An actionable recommendation based on the observation (e.g., "Isolate the cow and inspect its hoof for injury.", "Check for signs of respiratory illness in the flock.").'),urgency:r.z.enum(["High","Medium","Low"]).describe("The urgency of the recommendation.")}),d=r.z.object({animalCount:r.z.number().describe("The estimated number of animals detected in the image."),healthAnalysis:r.z.array(c).describe("A list of health-related observations and recommendations."),generalAdvice:r.z.string().describe('General preventative advice for the herd or flock. This should include proactive recommendations for medicine, supplements, vaccinations, deworming, or mating based on the animal type, common behaviors, and potential seasonal risks (e.g., "Consider a deworming protocol for your goats as they enter the wet season to prevent parasite load.", "Monitor chickens for signs of heat stress and ensure ample water during hot months.").'),visualDescription:r.z.string().optional().describe("A brief, one-sentence visual description of the main animal in the foreground, focusing on key features like color, markings, and breed characteristics."),suggestedId:r.z.string().optional().describe("A suggested unique ID for the animal based on its type and visual description (e.g., COW-BLKWHT-01).")});async function o(e){return h(e)}let m=n.ai.definePrompt({name:"analyzeLivestockHealthPrompt",input:{schema:l},output:{schema:d},prompt:"You are an expert veterinarian and livestock management AI. Your task is to analyze an image from a farm's camera feed showing {{{animalType}}} animals.\n\nAnalyze the provided image and perform the following tasks:\n1.  **Count the Animals:** Provide an estimated count of the animals visible in the image.\n2.  **Assess Health:** Carefully examine the animals for any signs of injury, disease, or unusual behavior (e.g., limping, isolation, lethargy, physical abnormalities). For each specific observation, provide a clear, actionable recommendation and an urgency level.\n3.  **Provide Preventative Advice:** Based on the animal type and general knowledge of animal husbandry, provide proactive 'generalAdvice'. This must include potential needs for medicine, supplements, vaccinations, deworming, or notes on mating readiness based on common seasonal concerns or animal behaviors. Be specific and actionable.\n4.  **Describe Visually**: If there is a clear animal in the foreground, provide a brief, one-sentence 'visualDescription' of it. Focus on distinct features like color, markings, or apparent breed.\n5.  **Suggest ID**: Based on the animal type and visual description, create a 'suggestedId'. The format should be a 3-letter abbreviation of the animal type, a 3-letter abbreviation of its main characteristics, and a number. For example, a black and white cow could be COW-BNW-01. A brown goat could be GOA-BRN-01.\n\nImage to Analyze: {{media url=imageDataUri}}"}),h=n.ai.defineFlow({name:"analyzeLivestockHealthFlow",inputSchema:l,outputSchema:d},async e=>{try{let{output:a}=await m(e);return a}catch(e){return console.error(e),{animalCount:0,healthAnalysis:[],generalAdvice:"The AI model could not process the request. Please try again with a clearer image.",visualDescription:"",suggestedId:""}}});var u=t(66695),p=t(30285),g=t(85057),f=t(66766),x=t(50172),v=t(67933),y=t(17832),j=t(45481),b=t(9255),w=t(40157);let A=(0,w.A)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),N=(0,w.A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var k=t(34301);let C=(0,w.A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var z=t(76570),I=t(55365),S=t(26126),L=t(68856),T=t(87481),M=t(59409),D=t(31949),O=t(19667),R=t(46102);let B=["Cow","Buffalo","Goat","Chicken","Sheep","Other"];function E(){let{toast:e}=(0,T.dj)(),[a,t]=(0,i.useState)(null),[n,r]=(0,i.useState)(null),[l,c]=(0,i.useState)(!1),[d,m]=(0,i.useState)("Cow"),h=(0,i.useRef)(null),w=(0,i.useRef)(null),[E,F]=(0,i.useState)(!1),[H,U]=(0,i.useState)(null),[P,Z]=(0,i.useState)(!1),q=()=>{w.current&&(clearInterval(w.current),w.current=null)};(0,i.useEffect)(()=>()=>{var e;q(),(null==(e=h.current)?void 0:e.srcObject)&&h.current.srcObject.getTracks().forEach(e=>e.stop())},[]),(0,i.useEffect)(()=>(P&&E&&!l?w.current=setInterval(()=>{V(!0)},1e4):q(),()=>q()),[P,E,l]);let W=async()=>{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){e({variant:"destructive",title:"Camera Not Supported",description:"Your browser does not support camera access."}),U(!1);return}try{let e=await navigator.mediaDevices.getUserMedia({video:!0});U(!0),F(!0),h.current&&(h.current.srcObject=e)}catch(a){console.error("Error accessing camera:",a),U(!1),F(!1),e({variant:"destructive",title:"Camera Access Denied",description:"Please enable camera permissions in your browser settings to use this feature."})}},_=function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(h.current){let t=document.createElement("canvas");t.width=h.current.videoWidth,t.height=h.current.videoHeight;let s=t.getContext("2d");if(s){s.drawImage(h.current,0,0,t.width,t.height);let i=t.toDataURL("image/jpeg");return a||(r(i),e({title:"Snapshot Captured",description:"You can now analyze the captured image."}),$()),i}}return null},V=async function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=n;if(a)s=_(!0);else if(E&&!(s=_(!1)))return;if(!s){a||e({variant:"destructive",title:"No Snapshot",description:"Please take a snapshot from the camera feed first."});return}c(!0),a||t(null);try{let e=await o({imageDataUri:s,animalType:d});t(e),r(s)}catch(t){console.error(t),a||e({variant:"destructive",title:"Analysis Failed",description:t.message||"An unexpected error occurred."})}finally{c(!1)}},G=async()=>{if(!a||!a.suggestedId)return void e({variant:"destructive",title:"Cannot Add Animal",description:"No suggested ID available from analysis."});let t={id:a.suggestedId,type:d,breed:a.visualDescription?a.visualDescription.split(",")[0]:"Unknown",gender:"Unknown",dob:new Date().toISOString().split("T")[0],status:"Healthy",purpose:"Growing"};try{await fetch("/api/livestock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),(0,O.j)("/api/livestock"),e({title:"Animal Added!",description:"Animal ".concat(a.suggestedId," has been added to your herd.")})}catch(a){console.error(a),e({variant:"destructive",title:"Failed to Add Animal"})}},$=()=>{var e;(null==(e=h.current)?void 0:e.srcObject)&&(h.current.srcObject.getTracks().forEach(e=>e.stop()),h.current.srcObject=null),F(!1),Z(!1)},J=e=>{switch(e){case"High":return"bg-red-500 text-white";case"Medium":return"bg-yellow-500 text-white";case"Low":return"bg-blue-500 text-white";default:return"bg-gray-500 text-white"}},Y=()=>(0,s.jsxs)(p.$,{onClick:()=>V(!1),disabled:l||!n&&!E||P,className:"w-full bg-accent hover:bg-accent/90 text-accent-foreground",children:[l&&!P?(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4 animate-spin"}):E?(0,s.jsx)(v.A,{className:"mr-2 h-4 w-4"}):(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),E?"Capture & Analyze":"Analyze Snapshot"]});return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"Live Livestock Analysis"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Use your farm's camera feed to monitor your herd's health and register new animals with AI."})]}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8 items-start",children:[(0,s.jsxs)(u.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsx)(u.ZB,{children:"Camera Feed Analysis"}),(0,s.jsx)(u.BT,{children:"Connect to your camera, analyze health, and identify new animals."})]}),(0,s.jsxs)(u.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(g.J,{children:"Camera Control"}),(0,s.jsx)("div",{className:"mt-2 aspect-video w-full relative rounded-md overflow-hidden border bg-muted flex items-center justify-center",children:E?(0,s.jsx)("video",{ref:h,className:"w-full h-full object-cover",muted:!0,playsInline:!0,autoPlay:!0}):n?(0,s.jsx)(f.default,{src:n,alt:"Livestock snapshot",fill:!0,style:{objectFit:"cover"}}):(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(j.A,{className:"mx-auto h-12 w-12"}),(0,s.jsx)("p",{children:"Connect to your live camera feed."})]})}),!E&&(0,s.jsxs)(p.$,{type:"button",variant:"outline",onClick:W,className:"w-full mt-2",children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Connect to Live Camera"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(g.J,{htmlFor:"auto-analyze",children:"Auto-Analyze Feed"}),(0,s.jsxs)("p",{className:"text-[0.8rem] text-muted-foreground",children:["Automatically analyze the feed every ",10," seconds."]})]}),(0,s.jsx)(D.d,{id:"auto-analyze",checked:P,onCheckedChange:Z,disabled:!E})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(g.J,{htmlFor:"animal-type",children:"Animal Type"}),(0,s.jsxs)(M.l6,{value:d,onValueChange:m,disabled:l,children:[(0,s.jsx)(M.bq,{id:"animal-type",children:(0,s.jsx)(M.yv,{placeholder:"Select animal type"})}),(0,s.jsx)(M.gC,{children:B.map(e=>(0,s.jsx)(M.eb,{value:e,children:e},e))})]})]})]}),(0,s.jsxs)(u.wL,{className:"gap-2",children:[(0,s.jsx)(R.Bc,{children:P?(0,s.jsxs)(R.m_,{children:[(0,s.jsx)(R.k$,{className:"w-full",asChild:!0,children:(0,s.jsx)("span",{children:(0,s.jsx)(Y,{})})}),(0,s.jsx)(R.ZI,{children:(0,s.jsx)("p",{children:"Manual analysis is disabled during auto-analysis."})})]}):(0,s.jsx)(Y,{})}),(0,s.jsxs)(p.$,{type:"button",variant:"ghost",onClick:()=>{r(null),U(null),t(null),$(),q()},disabled:l,children:[(0,s.jsx)(b.A,{className:"h-4 w-4"})," ",(0,s.jsx)("span",{className:"sr-only",children:"Reset"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[l&&!a&&(0,s.jsxs)(u.Zp,{className:"shadow-md",children:[(0,s.jsx)(u.aR,{children:(0,s.jsx)(L.E,{className:"h-8 w-3/4"})}),(0,s.jsxs)(u.Wu,{className:"space-y-4",children:[(0,s.jsx)(L.E,{className:"h-6 w-1/2"}),(0,s.jsx)(L.E,{className:"h-4 w-full"}),(0,s.jsx)(L.E,{className:"h-4 w-5/6"}),(0,s.jsx)(L.E,{className:"h-4 w-full"})]})]}),a&&(0,s.jsxs)(u.Zp,{className:"shadow-lg transition-all duration-300 ".concat(l?"opacity-50":"opacity-100"),children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsxs)(u.ZB,{className:"flex items-center gap-2",children:[l?(0,s.jsx)(x.A,{className:"h-6 w-6 text-primary animate-spin"}):(0,s.jsx)(A,{className:"text-primary h-6 w-6"}),(0,s.jsx)("span",{children:"Analysis Results"})]}),(0,s.jsxs)(u.BT,{children:["Found approximately ",a.animalCount," animal(s). ",l&&"(Updating...)"]})]}),(0,s.jsxs)(u.Wu,{className:"space-y-6",children:[a.suggestedId&&(0,s.jsxs)(u.Zp,{children:[(0,s.jsx)(u.aR,{children:(0,s.jsxs)(u.ZB,{className:"flex items-center gap-2 text-base",children:[(0,s.jsx)(N,{className:"text-primary"})," AI Animal Identification"]})}),(0,s.jsxs)(u.Wu,{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:a.visualDescription}),(0,s.jsxs)("div",{className:"flex items-center justify-between bg-muted/50 p-3 rounded-md",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs font-semibold",children:"Suggested ID"}),(0,s.jsx)("p",{className:"font-mono font-bold text-primary",children:a.suggestedId})]}),(0,s.jsxs)(p.$,{size:"sm",onClick:G,children:[(0,s.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Add to Herd"]})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold flex items-center gap-2 mb-2",children:[(0,s.jsx)(C,{})," Health Observations"]}),a.healthAnalysis.length>0?(0,s.jsx)("div",{className:"space-y-4",children:a.healthAnalysis.map((e,a)=>(0,s.jsxs)(I.Fc,{variant:"High"===e.urgency?"destructive":"default",children:[(0,s.jsxs)(I.XL,{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:"Observation"}),(0,s.jsxs)(S.E,{className:J(e.urgency),children:[e.urgency," Urgency"]})]}),(0,s.jsx)(I.TN,{children:e.observation}),(0,s.jsx)("h4",{className:"font-semibold mt-2 text-sm",children:"Recommendation:"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.recommendation})]},a))}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No specific health issues detected."})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,s.jsx)(z.A,{})," General Advice"]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:a.generalAdvice})]})]})]}),!a&&!l&&n&&(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsx)(u.ZB,{children:"Ready to Analyze"}),(0,s.jsx)(u.BT,{children:'Click the "Analyze Snapshot" button to get health insights for the captured image.'})]}),(0,s.jsx)(u.Wu,{children:(0,s.jsx)(f.default,{src:n,alt:"Livestock snapshot",width:1920,height:1080,className:"rounded-md border"})})]})]})]})]})}},45481:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])},46102:(e,a,t)=>{"use strict";t.d(a,{Bc:()=>l,ZI:()=>o,k$:()=>d,m_:()=>c});var s=t(95155),i=t(12115),n=t(78082),r=t(59434);let l=n.Kq,c=n.bL,d=n.l9,o=i.forwardRef((e,a)=>{let{className:t,sideOffset:i=4,...l}=e;return(0,s.jsx)(n.UC,{ref:a,sideOffset:i,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})});o.displayName=n.UC.displayName},50172:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},55365:(e,a,t)=>{"use strict";t.d(a,{Fc:()=>c,TN:()=>o,XL:()=>d});var s=t(95155),i=t(12115),n=t(74466),r=t(59434);let l=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),c=i.forwardRef((e,a)=>{let{className:t,variant:i,...n}=e;return(0,s.jsx)("div",{ref:a,role:"alert",className:(0,r.cn)(l({variant:i}),t),...n})});c.displayName="Alert";let d=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)("h5",{ref:a,className:(0,r.cn)("mb-1 font-medium leading-none tracking-tight",t),...i})});d.displayName="AlertTitle";let o=i.forwardRef((e,a)=>{let{className:t,...i}=e;return(0,s.jsx)("div",{ref:a,className:(0,r.cn)("text-sm [&_p]:leading-relaxed",t),...i})});o.displayName="AlertDescription"},63154:(e,a,t)=>{"use strict";t.d(a,{ai:()=>n});var s=t(254);let i=require("@genkit-ai/google-genai"),n=(0,s.genkit)({plugins:[(0,i.googleAI)()],model:"google-genai/gemini-1.5-flash"})},67933:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},68856:(e,a,t)=>{"use strict";t.d(a,{E:()=>n});var s=t(95155),i=t(59434);function n(e){let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",a),...t})}},76570:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(40157).A)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])}},e=>{var a=a=>e(e.s=a);e.O(0,[5511,9667,7239,7582,2043,4179,8082,1652,8441,1684,7358],()=>a(13612)),_N_E=e.O()}]);